<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>pallet.algo.fsmop documentation</title></head><body><div id="header"><h1><a href="index.html">Pallet-fsmop 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li class="current"><a href="pallet.algo.fsmop.html"><span>pallet.algo.fsmop</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="pallet.algo.fsmop.html#var-Control"><span>Control</span></a></li><li><a href="pallet.algo.fsmop.html#var-abort"><span>abort</span></a></li><li><a href="pallet.algo.fsmop.html#var-complete%3F"><span>complete?</span></a></li><li><a href="pallet.algo.fsmop.html#var-default-init-event-handler"><span>default-init-event-handler</span></a></li><li><a href="pallet.algo.fsmop.html#var-delay-for"><span>delay-for</span></a></li><li><a href="pallet.algo.fsmop.html#var-dofsm"><span>dofsm</span></a></li><li><a href="pallet.algo.fsmop.html#var-eval-in-env-fn"><span>eval-in-env-fn</span></a></li><li><a href="pallet.algo.fsmop.html#var-execute"><span>execute</span></a></li><li><a href="pallet.algo.fsmop.html#var-execute-after"><span>execute-after</span></a></li><li><a href="pallet.algo.fsmop.html#var-fail"><span>fail</span></a></li><li><a href="pallet.algo.fsmop.html#var-failed%3F"><span>failed?</span></a></li><li><a href="pallet.algo.fsmop.html#var-map*"><span>map*</span></a></li><li><a href="pallet.algo.fsmop.html#var-merge-fsms"><span>merge-fsms</span></a></li><li><a href="pallet.algo.fsmop.html#var-operate"><span>operate</span></a></li><li><a href="pallet.algo.fsmop.html#var-report-operation"><span>report-operation</span></a></li><li><a href="pallet.algo.fsmop.html#var-result"><span>result</span></a></li><li><a href="pallet.algo.fsmop.html#var-seq-steps"><span>seq-steps</span></a></li><li><a href="pallet.algo.fsmop.html#var-set-in-env-fn"><span>set-in-env-fn</span></a></li><li><a href="pallet.algo.fsmop.html#var-status"><span>status</span></a></li><li><a href="pallet.algo.fsmop.html#var-succeed"><span>succeed</span></a></li><li><a href="pallet.algo.fsmop.html#var-timeout"><span>timeout</span></a></li><li><a href="pallet.algo.fsmop.html#var-update-state"><span>update-state</span></a></li><li><a href="pallet.algo.fsmop.html#var-wait-for"><span>wait-for</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>pallet.algo.fsmop documentation</h2><pre class="doc">Operations

Operate provides orchestration. It assumes that operations can succeed, fail,
time-out or be aborted. It assumes some things happen in parallel, and that some
things need to be sequenced.


## Operation primitive FSM contract

An operation primitive must produce a FSM specification.

The FSM must respond to the :start event in it's initial state. The event data
sent with the :start event will be the current global state. The default initial
state is :init. The default response for the :start event in the :init state is
to set the primitive's :state-data to the global state, and to transition to
the :running state.

The FSM must have a :completed and a :failed state.

It must respond to the :abort event, which is sent on a user initiated abort
of an operation. The :abort event should cause the FSM to end in the :aborted
state.

The :init, :completed, :aborted and :failed states will be implicitly added if
not declared.

The result should be placed on the :result key of the state-data.

A failure reason should be placed on the :fail-reason key of the state-data.

State event functions (on-enter and on-exit) should return true if they do
anything to change the state of the FSM, and further event functions should not
be called for the transition.


## The `operation` FSM comprehension

An expression under the `operation` FSM comprehension results in a compound
FSM. It is returned as a function, that takes a state, and returns a map of
functions to control the resulting FSM.</pre><div class="public" id="var-Control"><h3>Control</h3><div class="usage"></div><pre class="doc">Operation control protocol.
</pre></div><div class="public" id="var-abort"><h3>abort</h3><div class="usage"><code>(abort _)</code></div><pre class="doc">Abort the operation.
</pre></div><div class="public" id="var-complete%3F"><h3>complete?</h3><div class="usage"><code>(complete? _)</code></div><pre class="doc">Predicate to test if operation is complete.
</pre></div><div class="public" id="var-default-init-event-handler"><h3>default-init-event-handler</h3><div class="usage"><code>(default-init-event-handler state event event-data)</code></div><pre class="doc">Default event handler for the :init state
</pre></div><div class="public" id="var-delay-for"><h3>delay-for</h3><div class="usage"><code>(delay-for delay delay-units)</code></div><pre class="doc">An operation primitive that does nothing for the given `delay`. This uses the
stateful-fsm's timeout mechanism. Not the timeout primitive. The primitive
transitions to :completed after the given delay.</pre></div><div class="public" id="var-dofsm"><h3>dofsm</h3><div class="usage"><code>(dofsm op-name steps result)</code></div><pre class="doc">A comprehension that results in a compound FSM specification.
</pre></div><div class="public" id="var-eval-in-env-fn"><h3>eval-in-env-fn</h3><div class="usage"><code>(eval-in-env-fn form syms)</code></div><pre class="doc">Give a form, return a function of a single `env` argument and that evaluates
the form in the given environment.</pre></div><div class="public" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute f)</code></div><pre class="doc">Execute a function in the operate-executor thread pool.
</pre></div><div class="public" id="var-execute-after"><h3>execute-after</h3><div class="usage"><code>(execute-after f delay delay-units)</code></div><pre class="doc">Execute a function after a specified delay in the scheduled-executor thread
pool. Returns a ScheduledFuture.</pre></div><div class="public" id="var-fail"><h3>fail</h3><div class="usage"><code>(fail reason)</code><code>(fail)</code></div><pre class="doc">An operation primitive that does nothing but fail immediately.
</pre></div><div class="public" id="var-failed%3F"><h3>failed?</h3><div class="usage"><code>(failed? _)</code></div><pre class="doc">Predicate to test if operation is failed.
</pre></div><div class="public" id="var-map*"><h3>map*</h3><div class="usage"><code>(map* fsm-configs)</code></div><pre class="doc">Execute a set of fsms
</pre></div><div class="public" id="var-merge-fsms"><h3>merge-fsms</h3><div class="usage"><code>(merge-fsms &amp; fsm-configs)</code></div><pre class="doc">Merge operation primitve FSM's.
</pre></div><div class="public" id="var-operate"><h3>operate</h3><div class="usage"><code>(operate operation)</code></div><pre class="doc">Start the specified `operation` on the given arguments. The call returns an
object that implements the Control protocol.</pre></div><div class="public" id="var-report-operation"><h3>report-operation</h3><div class="usage"><code>(report-operation operation)</code></div><pre class="doc">Print a report on the status of an operation.
</pre></div><div class="public" id="var-result"><h3>result</h3><div class="usage"><code>(result value)</code></div><pre class="doc">An operation primitive that does nothing but succeed immediately with the
specified result `value`.</pre></div><div class="public" id="var-seq-steps"><h3>seq-steps</h3><div class="usage"><code>(seq-steps steps result)</code></div><pre class="doc">Takes FSM comprehension forms and translates them
</pre></div><div class="public" id="var-set-in-env-fn"><h3>set-in-env-fn</h3><div class="usage"><code>(set-in-env-fn expr)</code></div><pre class="doc">Give an expression that is a valid lhs in a binding, return a function of an
`env` argument and a value that assigns the results of destructuring into
`env`.</pre></div><div class="public" id="var-status"><h3>status</h3><div class="usage"><code>(status _)</code></div><pre class="doc">Return the status of the operation.
</pre></div><div class="public" id="var-succeed"><h3>succeed</h3><div class="usage"><code>(succeed)</code></div><pre class="doc">An operation primitive that does nothing but succeed immediately.
</pre></div><div class="public" id="var-timeout"><h3>timeout</h3><div class="usage"><code>(timeout fsm-config delay delay-units)</code></div><pre class="doc">Execute an expression with a timeout. The timeout is applied to each
state. Any transition out of a state will cancel the timeout.</pre></div><div class="public" id="var-update-state"><h3>update-state</h3><div class="usage"><code>(update-state state state-kw f &amp; args)</code></div><pre class="doc">Convenience update function.
</pre></div><div class="public" id="var-wait-for"><h3>wait-for</h3><div class="usage"><code>(wait-for _)</code></div><pre class="doc">wait on the result of the completed operation
</pre></div></div></body></html>